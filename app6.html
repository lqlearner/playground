<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Transformer è¾“å‡ºå¯è§†åŒ–æ¼”ç¤º</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 40px;
    }
    .output {
      font-size: 24px;
      margin-bottom: 20px;
    }
    .bar-chart {
      display: flex;
      gap: 12px;
      align-items: flex-end;
      height: 150px;
      margin-bottom: 20px;
    }
    .bar {
      width: 40px;
      background: #4A90E2;
      text-align: center;
      color: white;
      border-radius: 4px 4px 0 0;
      position: relative;
    }
    .bar span {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-bottom: 4px;
      font-size: 14px;
      color: #333;
    }
    .options {
      margin-top: 10px;
    }
    .options button {
      margin-right: 10px;
      padding: 8px 14px;
      font-size: 16px;
      cursor: pointer;
    }
    .dice {
      margin-top: 30px;
      font-size: 60px;
      text-align: center;
      user-select: none;
    }
    .dice button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Transformer è¾“å‡ºæ¨¡æ‹Ÿå™¨</h1>
  <div class="output" id="output">æˆ‘æ— æ³•åˆ¤æ–­é›ªå±±çš„ç¾</div>
  <div id="chart" class="bar-chart"></div>
  <div class="options" id="options"></div>
  <div class="dice">
    <div id="diceFace">ğŸ²</div>
    <button onclick="rollDice()">æ·éª°å­</button>
    <button onclick="restart()">é‡æ–°å¼€å§‹</button>
  </div>

  <script>
    const tree = {
      "token": "ç¾",
      "children": [
        {
          "token": "ä¸½",
          "children": [
            {"token": "å› ", "children": [
              {"token": "ä¸º", "children": ["å±±åŠ¿é™©å³»"]},
              {"token": "æ­¤", "children": ["é€‰æ‹©åœ¨å¤å¤©ç™»é¡¶"]},
              {"token": "ä¸º", "children": ["é›ªå±±çš„é«˜åº¦å¾ˆé«˜"]}
            ]},
            {"token": "ç¨‹", "children": [
              {"token": "åº¦", "children": ["ï¼Œä½†æˆ‘ç›¸ä¿¡åœ¨é˜³å…‰çš„ç…§è€€ä¸‹ä¸€å®šä»¤äººå¿ƒç¢"]}
            ]},
            {"token": "ï¼Œ", "children": [
              {"token": "ä½†", "children": ["æˆ‘çŸ¥é“é£æ™¯å¦‚ç”»"]}
            ]}
          ]
        },
        {
          "token": "å¥½",
          "children": [
            {"token": "å¥‡", "children": ["æ™¯â€¦â€¦"]},
            {"token": "ï¼Œ", "children": ["åªå› å®ƒåœ¨é£ä¸­æ²‰é»˜ä¸è¯­â€¦â€¦"]},
            {"token": "ã€‚", "children": ["å› ä¸ºé£åªå€Ÿè¿‡ç‰‡åˆ»ï¼Œä¹Ÿæœªåœç•™â€¦â€¦"]}
          ]
        },
        {
          "token": "æœ¯",
          "children": [
            {"token": "ï¼Œ", "children": ["æ®Šä¸çŸ¥ï¼Œé›ªå±±çš„ç¾æ™¯ï¼Œæ®Šä¸ºå£®è§‚"]},
            {"token": "ã€‚", "children": ["è‰ºæœ¯æ— æ³•ç”¨è¯­è¨€å®Œå…¨è¡¨è¾¾â€¦â€¦"]}
          ]
        }
      ]
    };

    let currentPath = "æˆ‘æ— æ³•åˆ¤æ–­é›ªå±±çš„ç¾";

    function renderOptions(node) {
      const chart = document.getElementById("chart");
      const options = document.getElementById("options");
      chart.innerHTML = "";
      options.innerHTML = "";

      const probs = node.children.map(() => Math.random() * 100);
      const total = probs.reduce((a, b) => a + b, 0);

      node.children.forEach((child, i) => {
        const pct = Math.round((probs[i] / total) * 100);

        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.height = pct * 1.2 + "px";
        bar.innerHTML = `<span>${child.token}<br>${pct}%</span>`;
        chart.appendChild(bar);

        const btn = document.createElement("button");
        btn.innerText = child.token;
        btn.onclick = () => {
          currentPath += child.token;
          document.getElementById("output").innerText = currentPath;
          if (Array.isArray(child.children)) {
            if (typeof child.children[0] === 'string') {
              currentPath += child.children[0];
              document.getElementById("output").innerText = currentPath;
              chart.innerHTML = "";
              options.innerHTML = "<em>ç”Ÿæˆç»“æŸ</em>";
            } else {
              renderOptions(child);
            }
          } else {
            chart.innerHTML = "";
            options.innerHTML = "<em>ç”Ÿæˆç»“æŸ</em>";
          }
        };
        options.appendChild(btn);
      });
    }

    function rollDice() {
      const face = document.getElementById("diceFace");
      const faces = ["1ï¸âƒ£", "1ï¸âƒ£", "2ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£", "3ï¸âƒ£"];
      let count = 0;
      const interval = setInterval(() => {
        face.textContent = faces[Math.floor(Math.random() * 6)];
        count++;
        if (count > 20) {
          clearInterval(interval);
        }
      }, 100);
    }

    function restart() {
      currentPath = "æˆ‘æ— æ³•åˆ¤æ–­é›ªå±±çš„ç¾";
      document.getElementById("output").innerText = currentPath;
      renderOptions(tree);
    }

    renderOptions(tree);
  </script>
</body>
</html>
