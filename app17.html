<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Transformer è¾“å‡ºå¯è§†åŒ–æ¼”ç¤º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f7f7f7;
      --text:#111;
      --muted:#666;
      --primary:#4A90E2;
      --radius:14px;
    }
    /* å…¨å±€ä¸å±…ä¸­å¸ƒå±€ */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif;
      color:var(--text);
      background:var(--bg);
      display:flex;
      align-items:center;       /* å‚ç›´å±…ä¸­ */
      justify-content:center;   /* æ°´å¹³å±…ä¸­ */
      padding:24px;
    }
    .container{
      width:min(920px, 100%);
      background:#fff;
      padding:32px 24px;
      border-radius:var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.06);
      text-align:center;        /* æ–‡æœ¬ä¸å†…å…ƒç´ å±…ä¸­ */
    }
    h1{
      margin:0 0 12px;
      font-size:28px;
      letter-spacing:.5px;
    }
    .sub{
      margin:0 0 20px;
      color:var(--muted);
      font-size:14px;
    }
    .output{
      font-size:24px;
      margin: 10px auto 20px;
      font-weight:600;
      line-height:1.4;
    }

    /* æŸ±çŠ¶å›¾å®¹å™¨ä¸æŸ±å­ */
    .bar-wrap{
      display:flex;
      justify-content:center;   /* æ°´å¹³å±…ä¸­æ‰€æœ‰æŸ±å­ */
      align-items:flex-end;
      gap:12px;
      height:180px;
      margin: 0 auto 22px;
      padding: 10px 8px;
      border-radius:12px;
      background:linear-gradient(180deg, #fafafa, #f1f1f1);
    }
    .bar{
      width:44px;
      background:var(--primary);
      text-align:center;
      color:#fff;
      border-radius:8px 8px 0 0;
      position:relative;
      transition:height .25s ease;
    }
    .bar span{
      position:absolute;
      bottom:100%;
      left:50%;
      transform:translateX(-50%);
      margin-bottom:6px;
      font-size:13px;
      color:#333;
      line-height:1.2;
      white-space:nowrap;
    }

    /* é€‰é¡¹æŒ‰é’®æ•´ä½“ä¸æŒ‰é’®æ ·å¼ï¼ˆå±…ä¸­ï¼‰ */
    .options{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;   /* å±…ä¸­æŒ‰é’® */
      gap:10px;
      margin:0 auto 8px;
    }
    .btn{
      appearance:none;
      border:1px solid #e5e5e5;
      background:#fff;
      padding:10px 16px;
      font-size:16px;
      border-radius:10px;
      cursor:pointer;
      transition:transform .06s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .btn:hover{
      box-shadow:0 6px 16px rgba(0,0,0,.06);
      border-color:#ddd;
    }
    .btn:active{ transform:scale(.98) }

    /* éª°å­åŒºåŸŸï¼ˆå±…ä¸­ï¼‰ */
    .dice{
      margin-top:22px;
      display:flex;
      flex-direction:column;
      align-items:center;       /* å‚ç›´æ–¹å‘ä¸Šå†…å®¹å±…ä¸­ */
      justify-content:center;   /* æ°´å¹³æ–¹å‘ä¸Šå†…å®¹å±…ä¸­ */
      gap:10px;
    }
    #diceFace{
      font-size:60px;
      user-select:none;
      line-height:1;
    }
    .dice .btn{
      font-size:16px;
      padding:10px 18px;
    }

    /* å°å±ä¼˜åŒ– */
    @media (max-width: 480px){
      .output{ font-size:20px }
      .bar-wrap{ height:160px }
      .bar{ width:36px }
      .btn{ font-size:15px; padding:9px 14px }
    }
  </style>
</head>
<body>
  <main class="container" role="main">
    <h1>Transformer è¾“å‡ºæ¨¡æ‹Ÿå™¨</h1>

    <div class="output" id="output">æˆ‘æ— æ³•åˆ¤æ–­é›ªå±±çš„ç¾</div>

    <div id="chart" class="bar-wrap" aria-label="æ¦‚ç‡æŸ±çŠ¶å›¾"></div>

    <div class="options" id="options" aria-label="å¯é€‰token"></div>

    <div class="dice" aria-live="polite">
      <div id="diceFace" aria-label="éª°å­å½“å‰é¢">ğŸ²</div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button class="btn" onclick="rollDice()">æ·éª°å­</button>
        <button class="btn" onclick="restart()">é‡æ–°å¼€å§‹</button>
      </div>
    </div>
  </main>

  <script>
    const tree = {
      "token": "ç¾",
      "children": [
        {
          "token": "ä¸½",
          "children": [
            {"token": "å› ", "children": [
              {"token": "ä¸º", "children": ["å±±åŠ¿é™©å³»"]},
              {"token": "æ­¤", "children": ["é€‰æ‹©åœ¨å¤å¤©ç™»é¡¶"]},
              {"token": "ä¸º", "children": ["é›ªå±±çš„é«˜åº¦å¾ˆé«˜"]}
            ]},
            {"token": "ç¨‹", "children": [
              {"token": "åº¦", "children": ["ï¼Œä½†æˆ‘ç›¸ä¿¡åœ¨é˜³å…‰çš„ç…§è€€ä¸‹ä¸€å®šä»¤äººå¿ƒç¢"]}
            ]},
            {"token": "ï¼Œ", "children": [
              {"token": "ä½†", "children": ["æˆ‘çŸ¥é“é£æ™¯å¦‚ç”»"]}
            ]}
          ]
        },
        {
          "token": "å¥½",
          "children": [
            {"token": "å¥‡", "children": ["æ™¯â€¦â€¦"]},
            {"token": "ï¼Œ", "children": ["åªå› å®ƒåœ¨é£ä¸­æ²‰é»˜ä¸è¯­â€¦â€¦"]},
            {"token": "ã€‚", "children": ["å› ä¸ºé£åªå€Ÿè¿‡ç‰‡åˆ»ï¼Œä¹Ÿæœªåœç•™â€¦â€¦"]}
          ]
        },
        {
          "token": "æœ¯",
          "children": [
            {"token": "ï¼Œ", "children": ["æ®Šä¸çŸ¥ï¼Œé›ªå±±çš„ç¾æ™¯ï¼Œæ®Šä¸ºå£®è§‚"]},
            {"token": "ã€‚", "children": ["è‰ºæœ¯æ— æ³•ç”¨è¯­è¨€å®Œå…¨è¡¨è¾¾â€¦â€¦"]}
          ]
        }
      ]
    };

    let currentPath = "æˆ‘æ— æ³•åˆ¤æ–­é›ªå±±çš„ç¾";

    function renderOptions(node) {
      const chart = document.getElementById("chart");
      const options = document.getElementById("options");
      chart.innerHTML = "";
      options.innerHTML = "";

      const probs = node.children.map(() => Math.random() * 100);
      const total = probs.reduce((a, b) => a + b, 0);

      node.children.forEach((child, i) => {
        const pct = Math.round((probs[i] / total) * 100);

        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.height = pct * 1.2 + "px";
        bar.innerHTML = `<span>${child.token}<br>${pct}%</span>`;
        chart.appendChild(bar);

        const btn = document.createElement("button");
        btn.className = "btn";
        btn.innerText = child.token;
        btn.setAttribute("aria-label", `é€‰æ‹©ä»¤ç‰Œ ${child.token}`);
        btn.onclick = () => {
          currentPath += child.token;
          document.getElementById("output").innerText = currentPath;
          if (Array.isArray(child.children)) {
            if (typeof child.children[0] === 'string') {
              currentPath += child.children[0];
              document.getElementById("output").innerText = currentPath;
              chart.innerHTML = "";
              options.innerHTML = "<em>ç”Ÿæˆç»“æŸ</em>";
            } else {
              renderOptions(child);
            }
          } else {
            chart.innerHTML = "";
            options.innerHTML = "<em>ç”Ÿæˆç»“æŸ</em>";
          }
        };
        options.appendChild(btn);
      });
    }

    function rollDice() {
      const face = document.getElementById("diceFace");
      const faces = ["1ï¸âƒ£", "1ï¸âƒ£", "2ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£", "3ï¸âƒ£"];
      let count = 0;
      const interval = setInterval(() => {
        face.textContent = faces[Math.floor(Math.random() * 6)];
        count++;
        if (count > 20) {
          clearInterval(interval);
        }
      }, 100);
    }

    function restart() {
      currentPath = "æˆ‘æ— æ³•åˆ¤æ–­é›ªå±±çš„ç¾";
      document.getElementById("output").innerText = currentPath;
      renderOptions(tree);
      document.getElementById("diceFace").textContent = "ğŸ²";
    }

    renderOptions(tree);
  </script>
</body>
</html>
